<div
  class="fixed bottom-0 left-0 w-full bg-white z-4 shadow-top border-top-1 border-gray-100 px-4 py-3 fadein-animation">
  <!-- Fila de Botones de Pago -->
  <div class="flex gap-2 mb-3 align-items-start">
    @for (method of methods(); track method.id) {
      <div class="flex-1 flex flex-column gap-2">
        <!-- BOTÓN TOGGLE -->
        <div
          class="border-1 border-round-xl p-2 cursor-pointer transition-all flex flex-column align-items-center justify-content-center gap-1 h-4rem relative overflow-hidden"
          [class.border-indigo-600]="method.active && method.id !== 'YAPE'"
          [class.bg-indigo-50]="method.active && method.id !== 'YAPE'"
          [class.text-indigo-700]="method.active && method.id !== 'YAPE'"
          [class.border-pink-500]="method.active && method.id === 'YAPE'"
          [class.bg-pink-50]="method.active && method.id === 'YAPE'"
          [class.text-pink-600]="method.active && method.id === 'YAPE'"
          [class.border-gray-200]="!method.active"
          [class.text-gray-500]="!method.active"
          [class.opacity-60]="!method.active"
          (click)="toggleMethod(method.id)">
          <i [class]="method.icon" class="text-xl"></i>
          <span class="text-xs font-bold">{{ method.label }}</span>

          <!-- Check mark si está activo -->
          @if (method.active) {
            <div class="absolute top-0 right-0 p-1">
              <i class="pi pi-check-circle text-xs"></i>
            </div>
          }
        </div>

        <!-- INPUT DE MONTO (Solo aparece si hay Múltiples activos) -->
        @if (activeMethods().length > 1 && method.active) {
          <div class="fadein-animation">
            <div class="relative w-full">
              <span
                class="absolute left-2 translate-y-50 text-gray-400 text-xs font-bold position-custom"
                >S/</span
              >
              <input
                type="number"
                [ngModel]="method.amount"
                (ngModelChange)="updateAmount(method.id, $event)"
                class="w-full border-1 border-gray-300 border-round-lg py-2 pl-4 pr-1 text-center font-bold text-gray-800 text-sm outline-none focus:border-indigo-500 transition-colors"
                placeholder="0.00" />
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Alerta de Restante (Solo modo Híbrido) -->
  @if (activeMethods().length > 1 && remaining() > 0.1) {
    <div
      class="bg-red-50 border-1 border-red-100 border-round-lg px-3 py-1 mb-2 text-center fadein-animation">
      <span class="text-xs text-red-600 font-bold">
        Falta cubrir: S/ {{ remaining() | number: '1.2-2' }}
      </span>
    </div>
  }

  <!-- Total y Cobrar -->
  <div class="flex justify-content-between align-items-center mb-3">
    <span class="text-xs font-bold text-gray-500 uppercase letter-spacing-1"
      >Total a Pagar</span
    >
    <span class="text-3xl font-black text-gray-900"
      >S/ {{ posService.grandTotal() | number: '1.2-2' }}</span
    >
  </div>

  <button
    class="w-full bg-indigo-700 text-white py-3 border-round-xl font-bold text-lg shadow-3 border-none cursor-pointer hover:bg-indigo-800 active:scale-95 transition-all flex justify-content-center align-items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
    [disabled]="activeMethods().length > 1 && remaining() > 0.1"
    (click)="handleCheckout()">
    <i class="pi pi-check-circle text-xl"></i>
    <span>COBRAR</span>
  </button>
</div>
