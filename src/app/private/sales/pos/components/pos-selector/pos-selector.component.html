@if (posService.modalState().isOpen) {
  <div
    class="fixed top-0 left-0 w-full h-full z-6 flex align-items-end sm:align-items-center justify-content-center glass-overlay fadein-animation">
    <div
      class="bg-white w-full sm:w-30rem border-round-top-2xl sm:border-round-2xl p-4 shadow-6 slide-up max-h-screen overflow-y-auto relative">
      <button
        class="absolute top-0 right-0 m-3 bg-transparent border-none text-gray-400 hover:text-gray-600 cursor-pointer p-2"
        (click)="posService.closeModal()">
        <i class="pi pi-times text-xl"></i>
      </button>

      <!-- Info Producto -->
      <div class="mb-4 pr-5">
        <h2 class="text-xl font-bold text-gray-900 m-0 line-height-2">
          {{ posService.modalState().product?.name }}
        </h2>
        <p class="text-gray-500 text-sm font-mono m-0 mt-1">
          SKU: {{ displaySku() }}
        </p>
      </div>

      <!-- Precio Negociable -->
      <div
        class="mb-4 bg-yellow-50 border-1 border-yellow-200 border-round-xl p-3 flex justify-content-between align-items-center">
        <span class="text-xs font-bold text-yellow-800 uppercase"
          >Precio Unitario:</span
        >
        <div class="relative">
          <span
            class="absolute text-gray-500 text-lg font-bold"
            style="left: 0; top: 50%; transform: translateY(-50%)"
            >S/</span
          >
          <input
            type="number"
            [(ngModel)]="tempPrice"
            class="w-8rem text-right font-black text-2xl bg-transparent border-none outline-none text-gray-900 p-0"
            (focus)="$any($event.target).select()" />
        </div>
      </div>

      <!-- Tallas -->
      <div class="mb-4">
        <span class="text-xs font-bold text-gray-400 uppercase block mb-2"
          >1. Selecciona Talla</span
        >
        <div class="flex gap-2 flex-wrap">
          @for (size of availableSizes(); track size) {
            <div
              class="px-4 py-3 border-1 border-round-xl cursor-pointer transition-all font-bold text-sm min-w-3rem text-center select-none shadow-1"
              [class.border-indigo-600]="tempSize() === size"
              [class.bg-indigo-600]="tempSize() === size"
              [class.text-white]="tempSize() === size"
              [class.border-gray-100]="tempSize() !== size"
              [class.bg-white]="tempSize() !== size"
              [class.text-gray-600]="tempSize() !== size"
              (click)="selectSize(size)">
              {{ size }}
            </div>
          }
        </div>
      </div>

      <!-- Colores -->
      <div
        class="mb-4"
        [class.opacity-50]="!tempSize()"
        [class.pointer-events-none]="!tempSize()">
        <div class="flex justify-content-between mb-2">
          <span class="text-xs font-bold text-gray-400 uppercase"
            >2. Selecciona Color</span
          >
          @if (tempColor(); as color) {
            <span
              class="text-xs font-bold"
              [class.text-green-600]="color.stock > 5"
              [class.text-red-500]="color.stock <= 5">
              Stock: {{ color.stock }}
            </span>
          }
        </div>
        <div class="flex gap-3 flex-wrap">
          @for (v of availableColors(); track v.colorName) {
            <div
              class="w-3rem h-3rem border-circle border-2 cursor-pointer relative shadow-1 transition-transform active:scale-90 flex align-items-center justify-content-center"
              [class.border-indigo-500]="tempColor() === v"
              [class.border-transparent]="
                tempColor() !== v && v.hex !== '#ffffff'
              "
              [class.border-gray-200]="v.hex === '#ffffff'"
              [style.background-color]="v.hex"
              (click)="v.stock > 0 ? selectColor(v) : null"
              [class.opacity-40]="v.stock === 0">
              @if (tempColor() === v) {
                <i
                  class="pi pi-check text-white text-xl shadow-2 border-circle p-1 bg-black-alpha-10"></i>
              }
            </div>
          }
        </div>
      </div>

      <!-- Footer: Cantidad y BotÃ³n -->
      <div class="flex gap-3 pt-3 border-top-1 border-gray-300">
        <div
          class="flex align-items-center border-1 border-gray-200 border-round-xl w-10rem justify-content-between px-1 bg-white shadow-1">
          <button
            class="p-3 border-none bg-transparent text-gray-500 font-bold hover:text-black cursor-pointer text-xl"
            (click)="adjustTempQty(-1)">
            -
          </button>
          <span class="font-bold text-xl text-gray-800">{{ tempQty }}</span>
          <button
            class="p-3 border-none bg-transparent text-indigo-600 font-bold hover:text-indigo-800 cursor-pointer text-xl"
            (click)="adjustTempQty(1)">
            +
          </button>
        </div>

        <button
          class="flex-1 font-bold py-3 bg-gray-900 text-white border-round-xl shadow-3 border-none cursor-pointer hover:bg-black transition-all disabled:opacity-50 text-lg"
          [disabled]="!tempSize() || !tempColor()"
          (click)="confirm()">
          {{ posService.modalState().isEditing ? 'GUARDAR' : 'AGREGAR' }}
        </button>
      </div>
    </div>
  </div>
}
